general:
  branches:
    ignore:
      - gh-pages

machine:
  node:
    version: v5.10.1

dependencies:
  pre:
    - bundle install
    - npm install -g cucumber
    - npm install -g grunt-cli

test:
  post:
    - BABEL_ENV=node grunt mochacov:junit
    - mkdir -p $CIRCLE_TEST_REPORTS/junit
    - find . -type f -regex ".*/logs/unit/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

#    - grunt mochacov:coverage

    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - BABEL_ENV=node cucumber.js --format=json:$CIRCLE_TEST_REPORTS/cucumber/tests.cucumber --tags=~@wip test/integration/features/ --compiler=js*:babel-register

deployment:
  production:
    branch: master
    heroku:
      appname: travi-org-admin
  gh-pages:
    branch: master
    commands:
      - npm run build-storybook
      - npm run gh-pages
