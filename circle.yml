machine:
  node:
    version: v4.0.0

dependencies:
  pre:
    - bundle install
    - npm install -g cucumber
    - npm install -g grunt-cli

test:
  post:
    - grunt mochacov:junit
    - mkdir -p $CIRCLE_TEST_REPORTS/junit
    - find . -type f -regex ".*/logs/unit/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

#    - grunt mochacov:coverage

    - mkdir -p $CIRCLE_TEST_REPORTS/cucumber
    - cucumber.js --format=json:$CIRCLE_TEST_REPORTS/cucumber/tests.cucumber --tags=~@wip test/integration/features/

deployment:
  staging:
    branch: master
    heroku:
      appname: infinite-lowlands-5332
